

- name: home
  slug: home
  width: wide
  head-widgets:
  - type: group
    widgets:
    - type: monitor
      title: c/infra
      hide-header: true
      cache: 5s
      sites:
      - title: argocd
        url: https://argocd.k8s.iaminyourpc.xyz
        icon: https://icon.icepanel.io/Technology/svg/Argo-CD.svg
        timeout: 10s
      - title: vault
        url: https://vault.k8s.iaminyourpc.xyz
        icon: https://docs.rconfig.com/images/logos/vault-hashicorp-logo-920x920-sue-v1.png
        timeout: 10s
      - title: kubewall
        url: http://kube.k8s.iaminyourpc.xyz
        icon: https://img.icons8.com/color/200/kubernetes.png
        timeout: 10s
      - title: longhorn
        url: http://longhorn.k8s.iaminyourpc.xyz
        icon: https://cdn.jsdelivr.net/gh/homarr-labs/dashboard-icons/svg/longhorn.svg
        timeout: 10s
        basic-auth:
          username: ${LONGHORN_USER}
          password: ${LONGHORN_PASSWORD}
    - type: monitor
      title: c/monitoring
      hide-header: true
      cache: 5s
      sites:
      - title: grafana
        url: https://grafana.k8s.iaminyourpc.xyz
        icon: di:grafana
        timeout: 10s
      - title: alloy
        url: https://alloy.k8s.iaminyourpc.xyz
        icon: di:alloy
        timeout: 10s
        basic-auth:
          username: ${ALLOY_USER}
          password: ${ALLOY_PASSWORD}
      - title: loki
        check-url: http://loki-backend.monitoring.svc:3100/ready
        url: https://argocd.k8s.iaminyourpc.xyz/applications/argocd/grafana-loki?view=tree&resource=
        icon: di:loki
        timeout: 10s
      - title: tempo
        check-url: http://grafana-tempo-querier.monitoring.svc:3100/ready
        url: https://argocd.k8s.iaminyourpc.xyz/applications/argocd/grafana-tempo?view=tree&resource=
        icon: https://grafana.com/static/assets/img/blog/tempo.png
        timeout: 10s
      - title: victoriametrics
        check-url: http://victoriametrics-vmselect.monitoring.svc:8481/health
        url: https://argocd.k8s.iaminyourpc.xyz/applications/argocd/victoriametrics?view=tree&resource=
        icon: https://i.imgur.com/176vBRC.png
        timeout: 10s
      - title: minio
        url: https://minio.k8s.iadfaewminyourpc.xyz
        icon: di:minio
        timeout: 10s
  columns:
  - size: small
    widgets:
    - type: custom-api
      hide-header: false
      title: car
      cache: 5s
      url: http://fetch-api.fetch-api.svc:8069/grafana/car-info
      method: POST
      body: {"ai": false}
      template: |
        {{/* --- API data extraction --- */}}
        {{ $items := .JSON.Array "items" }}

        {{ $batteryObj := (index $items 0) }}
        {{ $battery_usable_battery_percentage := ($batteryObj.Int "usable_battery_percentage") }}
        {{ $battery_usable_battery_kwh := ($batteryObj.String "usable_battery_kwh") }}
        {{ $battery_usable_battery_km := ($batteryObj.String "usable_battery_km") }}

        {{ $last_chargeObj := (index $items 1) }}
        {{ $last_charge_location := ($last_chargeObj.String "location") }}
        {{ $last_charge_charge_type := ($last_chargeObj.String "charge_type") }}
        {{ $last_charge_charge_energy_added_kwh := ($last_chargeObj.String "charge_energy_added_kwh") }}
        {{ $last_charge_last_charge_since := ($last_chargeObj.String "last_charge_since") }}
        {{ $last_charge_charge_energy_added_percentage := ($last_chargeObj.String "charge_energy_added_percentage") }}

        {{ $last_locationObj := (index $items 2) }}
        {{ $last_location_city := ($last_locationObj.String "city") }}
        {{ $last_location_address := ($last_locationObj.String "address") }}
        {{ $last_location_last_seen_since := ($last_locationObj.String "last_seen_since") }}

        {{ $stateObj := (index $items 3) }}
        {{ $state_state := ($stateObj.String "state") }}
        {{ $state_last_state_since := ($stateObj.String "last_state_since") }}

        {{ $efficiencyObj := (index $items 4) }}
        {{ $efficiency_average_consumption_wh_per_km := ($efficiencyObj.String "average_consumption_wh_per_km") }}
        {{ $efficiency_average_driving_efficiency_percentage := ($efficiencyObj.String "average_driving_efficiency_percentage") }}
        {{ $efficiency_full_charge_usable_battery_kwh := ($efficiencyObj.String "full_charge_usable_battery_kwh") }}
        {{ $efficiency_full_charge_usable_range_km := ($efficiencyObj.String "full_charge_usable_range_km") }}
        {{/* --- API data extraction ends --- */}}



        {{/* --- Extra vars --- */}}
        {{ $grafana_url := "https://grafana.k8s.iaminyourpc.xyz" }}
        {{ $grafana_dashboard_overview_url := printf "%s/d/kOuP_Fggz/overview" $grafana_url }}
        {{ $grafana_dashboard_battery_health_url := printf "%s/d/jchmRiqUfXgTM/battery-health" $grafana_url }}
        {{ $grafana_dashboard_charging_history_url := printf "%s/d/TSmNYvRRk/charging-history" $grafana_url }}
        {{/* --- Extra vars ends --- */}}


        <style>
          :host {
            display: block;
            height: auto !important;
            padding: 0 !important;
          }
          
          .divider {
            width: 100%;
            height: 1px;
            background-color: rgba(255,255,255,0.03);
            margin: 6px 0;
          }

          .root-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            padding: 6px 0;
          }

          .left-side {
            display: flex;
            flex-direction: column;
            gap: 5px;
            min-width: 0;
          }

          .right-side {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 6px;
            min-width: 40px;
          }

          .row {
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
            font-weight: 500;
          }

          .header-title {
            font-size: 20px;
            font-weight: 400;
            color: rgba(230,230,230,0.9);
            text-transform: capitalize;
          }

          .header-text {
            font-size: 15px;
            color: rgba(200,200,200,0.55);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
          }

          .title {
            font-size: 14px;
            font-weight: 100;
            color: rgba(230,230,230,0.9);
            text-transform: capitalize;
          }

          .text {
            font-size: 13px;
            color: rgba(200,200,200,0.55);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
          }

          .header-right-icon-car {
            width: 65px;
            height: 65px;
            -webkit-mask: url("https://i.imgur.com/oLmdiWK.png") no-repeat center;
            mask: url("https://i.imgur.com/oLmdiWK.png") no-repeat center;
            -webkit-mask-size: contain;
            mask-size: contain;
            background-color: var(--color-positive);
            position: relative;
            left: 7px;
          }

          .text-right-icon-battery {
            width: 21px;
            height: 21px;
            -webkit-mask: url("https://i.imgur.com/xMUsMaq.png") no-repeat center;
            mask: url("https://i.imgur.com/xMUsMaq.png") no-repeat center;
            -webkit-mask-size: contain;
            mask-size: contain;
            background-color: var(--color-positive);
            position: relative;
            left: 7px;
          }

          .text-right-icon-last-car-location {
            width: 21px;
            height: 21px;
            -webkit-mask: url("https://i.imgur.com/oaUvINa.png") no-repeat center;
            mask: url("https://i.imgur.com/oaUvINa.png") no-repeat center;
            -webkit-mask-size: contain;
            mask-size: contain;
            background-color: var(--color-positive);
            position: relative;
            left: 7px;
          }

          .text-right-icon-last-charge-location {
            width: 35px;
            height: 35px;
            -webkit-mask: url("https://i.imgur.com/7p89Jhp.png") no-repeat center;
            mask: url("https://i.imgur.com/7p89Jhp.png") no-repeat center;
            -webkit-mask-size: contain;
            mask-size: contain;
            background-color: var(--color-positive);
            position: relative;
            left: 7px;
          }

          .text-right-icon-efficiency {
            width: 19px;
            height: 19px;
            -webkit-mask: url("https://i.imgur.com/aPv3bvg.png") no-repeat center;
            mask: url("https://i.imgur.com/aPv3bvg.png") no-repeat center;
            -webkit-mask-size: contain;
            mask-size: contain;
            background-color: var(--color-positive);
            position: relative;
            left: 7px;
          }
        </style>
        


        {{/* # Car state */}}
        <div class="root-row">
          <div class="left-side">
            <div class="header-title">
              <a href="{{ $grafana_dashboard_overview_url }}" 
                target="_blank" 
                style="color:inherit;text-decoration:none;">
                {{ $state_state }}
              </a>
            </div>
            <div class="header-text">for {{ $state_last_state_since }}</div>
          </div>

          <div class="right-side">
            <div class="row">
              <div class="header-right-icon-car"></div>
            </div>
          </div>
        </div>


        <div class="divider"></div>


        {{/* # Battery */}}
        <div class="root-row">
          <div class="left-side">
            <div class="title">
              <a href="{{ $grafana_dashboard_battery_health_url }}" 
                target="_blank" 
                style="color:inherit;text-decoration:none; {{ if lt $battery_usable_battery_percentage 20 }}color: var(--color-negative){{ end }}">
                {{ $battery_usable_battery_percentage }}%
              </a>
            </div>
            <div class="text">
            {{ $battery_usable_battery_kwh }}kWh • {{ $battery_usable_battery_km }}km
            </div>
          </div>

          <div class="right-side">
            <div class="row">
              <div class="text-right-icon-battery" {{ if lt $battery_usable_battery_percentage 20 }}style="background-color: var(--color-negative)"{{ end }}></div>
            </div>
          </div>
        </div>


        {{/* # Car efficiency */}}
        <div class="root-row">
          <div class="left-side">
            <div class="title">
              <a href="{{ $grafana_dashboard_charging_history_url }}" 
                target="_blank" 
                style="color:inherit;text-decoration:none;">
                {{ $efficiency_average_driving_efficiency_percentage }}%
              </a>
            </div>
            <div class="text">{{ $efficiency_average_consumption_wh_per_km }}Wh/km</div>
            <div class="text">{{ $efficiency_full_charge_usable_battery_kwh }}kWh • {{ $efficiency_full_charge_usable_range_km }}km</div>
          </div>

          <div class="right-side">
            <div class="row">
              <div class="text-right-icon-efficiency"></div>
            </div>
          </div>
        </div>


        {{/* # Last car location */}}
        <div class="root-row">
          <div class="left-side">
            <div class="title">
              <a href="https://www.google.com/maps/search/?api=1&query={{ urlquery (printf "%s %s" $last_location_city $last_location_address) }}" 
                target="_blank" 
                style="color:inherit;text-decoration:none;">
                {{ $last_location_city }}
              </a>
            </div>
            <div class="title">
              <a href="https://www.google.com/maps/search/?api=1&query={{ urlquery (printf "%s %s" $last_location_city $last_location_address) }}" 
                target="_blank" 
                style="color:inherit;text-decoration:none;">
                {{ $last_location_address }}
              </a>
            </div>
            <div class="text">{{ $last_location_last_seen_since }} ago</div>
          </div>

          <div class="right-side">
            <div class="row">
              <div class="text-right-icon-last-car-location"></div>
            </div>
          </div>
        </div>


        {{/* # Last charge info */}}
        <div class="root-row">
          <div class="left-side">
            <div class="title">
              <a href="{{ $grafana_dashboard_charging_history_url }}" 
                target="_blank" 
                style="color:inherit;text-decoration:none;">
                {{ $last_charge_location }}
              </a>
            </div>
            <div class="text">{{ $last_charge_last_charge_since }} ago • {{ $last_charge_charge_type }}</div>
            <div class="text">+{{ $last_charge_charge_energy_added_percentage }}% • +{{ $last_charge_charge_energy_added_kwh }}kWh</div>
          </div>

          <div class="right-side">
            <div class="row">
              <div class="text-right-icon-last-charge-location"></div>
            </div>
          </div>
        </div>



    - type: calendar
      hide-header: true
      first-day-of-week: monday
    - type: monitor
      hide-header: true
      cache: 5s
      sites:
      - title: jellyfin
        url: https://watch.k8s.iaminyourpc.xyz
        icon: di:jellyfin
        timeout: 10s
      - title: immich
        url: https://photos.k8s.iaminyourpc.xyz
        icon: di:immich
        timeout: 10s
      - title: pihole
        url: http://pihole.k8s.iaminyourpc.xyz/admin
        icon: https://upload.wikimedia.org/wikipedia/commons/0/00/Pi-hole_Logo.png
        timeout: 10s
      - title: teslamate
        url: http://car.k8s.iaminyourpc.xyz
        icon: https://www.pngplay.com/wp-content/uploads/13/Tesla-Logo-PNG-Photo-Image.png
        timeout: 10s
        basic-auth:
          username: ${TESLAMATE_USER}
          password: ${TESLAMATE_PASSWORD}
  - size: full
    widgets:
    - type: custom-api
      hide-header: false
      title: t/drives
      cache: 5s
      url: http://fetch-api.fetch-api.svc:8069/grafana/car-drives-history
      method: POST
      parameters:
        number_of_drives: 100
      body: {"ai": false}
      template: |
        <style>
          :root {
            --c-primary: var(--color-primary);
            --c-dim: rgba(200,200,200,0.55);
            --c-light: rgba(230,230,230,0.9);
            --border: 1px solid rgba(255,255,255,0.08);

            --fs-top: 15px;
            --fs-bottom: 12px;
            --fs-mini: 14px;

            --gap-row: 10px;
            --gap-mini: 6px;
            --gap-mini-pair: 12px;

            --icon-size-sm: 14px;
            --icon-size-md: 17px;
            --icon-size-lg: 20px;
            --icon-size-battery: 21px;
            --icon-size-map: 21px;
            --icon-size-map-r: 22px;
          }

          :host {
            display: block;
            height: auto !important;
            padding: 0 !important;
          }

          .drive-item-box {
            background: transparent;
            border: var(--border);
            border-radius: 1rem;
            padding: 1.2rem;
            margin: 0;
          }

          .drive-item-box:not(:last-child) {
            margin-bottom: 1.2rem;
          }

          .drive-top-actions {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 8px;
          }

          .inner-box-small {
            border-radius: 0.5rem;
            padding: 4px 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: opacity .15s ease;
            margin-right: -4px;
          }

          .inner-box-small:hover {
            opacity: .7;
          }

          .drive-header-row {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            align-items: center;
            margin-bottom: 1rem;
          }

          .header-side {
            display: flex;
            align-items: center;
            gap: 10px;
          }

          .header-texts {
            display: flex;
            flex-direction: column;
            white-space: nowrap;
          }

          .top-text {
            font-size: var(--fs-top);
            color: var(--c-light);
            margin-bottom: 0.25rem;
          }

          .bottom-text {
            font-size: var(--fs-bottom);
            color: var(--c-dim);
            overflow: hidden;
            text-overflow: ellipsis;
          }

          .icon-mask {
            display: inline-block;
            background-color: var(--c-primary);
            -webkit-mask-size: contain;
            mask-size: contain;
            -webkit-mask-repeat: no-repeat;
            mask-repeat: no-repeat;
            -webkit-mask-position: center;
            mask-position: center;
          }

          .icon-map-l { width: var(--icon-size-map); height: var(--icon-size-map); -webkit-mask-image: url("https://i.imgur.com/OjiGrcA.png"); mask-image: url("https://i.imgur.com/OjiGrcA.png"); }
          .icon-map-r { width: var(--icon-size-map-r); height: var(--icon-size-map-r); -webkit-mask-image: url("https://i.imgur.com/cvseR7H.png"); mask-image: url("https://i.imgur.com/cvseR7H.png"); }
          .icon-battery { width: var(--icon-size-battery); height: var(--icon-size-battery); -webkit-mask-image: url("https://i.imgur.com/xMUsMaq.png"); mask-image: url("https://i.imgur.com/xMUsMaq.png"); }

          .grid {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            row-gap: var(--gap-row);
            column-gap: 16px;
          }

          .left  { justify-self: start; }
          .mid   { justify-self: center; }
          .right { justify-self: end; }

          .row {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: var(--fs-mini);
            white-space: nowrap;
            color: rgba(200,200,200,0.70);
          }

          .left .row span,
          .right .row span {
            color: var(--c-light);
          }

          .mid .row span {
            color: var(--c-light);
          }

          .dot {
            font-size: var(--fs-mini);
            color: var(--c-dim);
          }

          .inner-box {
            border: var(--border);
            border-radius: 0.6rem;
            padding: 6px 12px;
            display: inline-flex;
            gap: var(--gap-mini-pair);
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            grid-column: 2;
            width: auto;
          }

          .mini-pair {
            display: inline-flex;
            align-items: center;
            gap: var(--gap-mini);
          }

          .mini1 { width: var(--icon-size-sm); height: var(--icon-size-sm); -webkit-mask-image: url("https://i.imgur.com/aPv3bvg.png"); mask-image: url("https://i.imgur.com/aPv3bvg.png"); }
          .mini2 { width: var(--icon-size-md); height: var(--icon-size-md); -webkit-mask-image: url("https://i.imgur.com/mjQRIM0.png"); mask-image: url("https://i.imgur.com/mjQRIM0.png"); }
          .mini3 { width: var(--icon-size-lg); height: var(--icon-size-lg); -webkit-mask-image: url("https://i.imgur.com/fPqo2ku.png"); mask-image: url("https://i.imgur.com/fPqo2ku.png"); }
          .mini4 { width: var(--icon-size-sm); height: var(--icon-size-sm); -webkit-mask-image: url("https://i.imgur.com/wdKEI6e.png"); mask-image: url("https://i.imgur.com/wdKEI6e.png"); }
          .mini5 { width: var(--icon-size-sm); height: var(--icon-size-sm); -webkit-mask-image: url("https://i.imgur.com/f3huO5u.png"); mask-image: url("https://i.imgur.com/f3huO5u.png"); }
          .mini6 { width: var(--icon-size-sm); height: var(--icon-size-sm); -webkit-mask-image: url("https://i.imgur.com/RtYdECy.png"); mask-image: url("https://i.imgur.com/RtYdECy.png"); }
          .mini7 { width: 18px; height: 18px; -webkit-mask-image: url("https://i.imgur.com/cd0BU9N.png"); mask-image: url("https://i.imgur.com/cd0BU9N.png"); }
          .mini8 { width: 18px; height: 18px; -webkit-mask-image: url("https://i.imgur.com/DhCug74.png"); mask-image: url("https://i.imgur.com/DhCug74.png"); }

          .mini_grafana {
            width: 17px;
            height: 17px;
            -webkit-mask-image: url("https://i.imgur.com/VIXZ4qg.png");
            mask-image: url("https://i.imgur.com/VIXZ4qg.png");
          }

          .mini_maps {
            width: 16px;
            height: 16px;
            -webkit-mask-image: url("https://i.imgur.com/Q6IVpBr.png");
            mask-image: url("https://i.imgur.com/Q6IVpBr.png");
          }
        </style>

        <p>test</p>

        {{ $items := .JSON.Array "items" }}

        <ul class="list list-gap-10 collapsible-container" data-collapse-after="3">
          {{ range $items }}
            <li class="drive-item-box">

              <div class="drive-top-actions">
                <a class="inner-box-small" href="{{ .String "grafana_drive_url" }}" target="_blank">
                  <span class="icon-mask mini_grafana"></span>
                </a>

                <a class="inner-box-small" href="{{ .String "directions_url" }}" target="_blank">
                  <span class="icon-mask mini_maps"></span>
                </a>
              </div>

              <div class="drive-header-row">
                <div class="header-side">
                  <span class="icon-mask icon-map-l"></span>
                  <div class="header-texts">
                    <div class="top-text">{{ .String "start_address" }}</div>
                    <div class="bottom-text">{{ .String "start_time_ordinal" }}</div>
                  </div>
                </div>

                <div class="drive-header-middle">
                  <span class="top-text" style="color:var(--c-primary);">{{ .String "duration_end_since_start" }}</span>
                </div>

                <div class="header-side" style="justify-content:flex-end;">
                  <div class="header-texts" style="text-align:right;">
                    <div class="top-text">{{ .String "end_address" }}</div>
                    <div class="bottom-text">{{ .String "end_time_ordinal" }}</div>
                  </div>
                  <span class="icon-mask icon-map-r"></span>
                </div>
              </div>

              <div class="grid">

                <div class="left">
                  <div class="row">
                    <span class="icon-mask icon-battery"></span>
                    <span>{{ .String "start_battery_percentage" }}%</span>
                  </div>
                </div>

                <div class="mid">
                  <div class="row">
                    <span>{{ .String "average_speed_kmh" }}km/h</span>
                    {{ if ne (.String "average_consumption_wh_per_km") "N/A" }}
                      <span class="dot">•</span>
                      <span>{{ .String "average_consumption_wh_per_km" }}Wh/km</span>
                    {{ end }}
                  </div>
                </div>

                <div class="right">
                  <div class="row">
                    <span>{{ .String "end_battery_percentage" }}%</span>
                    <span class="icon-mask icon-battery"></span>
                  </div>
                </div>

                <div class="inner-box">

                  <span class="mini-pair">
                    <span class="icon-mask mini4"></span>
                    <span>-{{ .String "battery_used_percentage" }}%</span>
                  </span>

                  {{ if ne (.String "total_consumption_kwh") "N/A" }}
                    <span class="mini-pair">
                      <span class="icon-mask mini5"></span>
                      <span>-{{ .String "total_consumption_kwh" }}kWh</span>
                    </span>
                  {{ end }}

                  {{ if ne (.String "average_driving_efficiency_percentage") "N/A" }}
                    <span class="mini-pair">
                      <span class="icon-mask mini1"></span>
                      <span>{{ .String "average_driving_efficiency_percentage" }}%</span>
                    </span>
                  {{ end }}

                  <span class="mini-pair">
                    <span class="icon-mask mini3"></span>
                    <span>{{ .String "distance_km" }}km</span>
                  </span>

                  <span class="mini-pair">
                    <span class="icon-mask mini7"></span>
                    <span>↑ {{ .String "max_speed_kmh" }}km/h</span>
                  </span>

                  <span class="mini-pair">
                    <span class="icon-mask mini8"></span>
                    <span>↑ {{ .String "max_power_kw" }}kW</span>
                  </span>

                  <span class="mini-pair">
                    <span class="icon-mask mini2"></span>
                    <span>{{ .String "outside_temperature_celsius" }}°C</span>
                  </span>

                  {{ if .Bool "reduced_range" }}
                    <span class="mini-pair">
                      <span class="icon-mask mini6"></span>
                      <span>Reduced range</span>
                    </span>
                  {{ end }}

                </div>

              </div>

            </li>
          {{ end }}
        </ul>


    - type: videos
      channels:
      - UCXuqSBlHAE6Xw-yeJA0Tunw
      - UCR-DXc1voovS8nhAvccRZhg
      - UCsBjURrPoezykLs9EqgamOA
      - UCBJycsmduvYEL83R_U4JriQ
      - UCHnyfMqiRRG1u-2MsSQLbXA
    - type: group
      widgets:
      - type: reddit
        subreddit: technology
        show-thumbnails: true
      - type: reddit
        subreddit: selfhosted
        show-thumbnails: true
  - size: small
    widgets:
    - type: weather
      hide-header: true
      location: Sofia, Bulgaria
      units: metric
      hour-format: 24h
